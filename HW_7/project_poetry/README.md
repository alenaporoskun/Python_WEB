## Домашнє завдання #7

## Основне завдання

### Вступна частина

У цьому домашньому завданні ми продовжимо працювати з домашнім завданням із попереднього модуля.
В цій домашній роботі використаємо базу даних postgres. У командному рядку запустіть Docker контейнер:

```docker run --name some-postgres -p 5432:5432 -e POSTGRES_PASSWORD=mysecretpassword -d postgres```

Замість some-postgres виберіть свою назву контейнера, а замість mysecretpassword придумайте свій пароль для підключення до бази даних

### Кроки виконання домашнього завдання​

* Перший крок​
  
Реалізуйте свої моделі SQLAlchemy, для таблиць:   
  
* Таблиця студентів;  
* Таблиця груп;
* Таблиця викладачів;
* Таблиця предметів із вказівкою викладача, який читає предмет;
* Таблиця де кожен студент має оцінки з предметів із зазначенням коли оцінку отримано;  
  
* Другий крок
  
Використовуйте alembic для створення міграцій у базі даних.  

* Третій крок  
  
Напишіть скрипт seed.py та заповніть отриману базу даних випадковими даними (~30-50 студентів, 3 групи, 5-8 предметів, 3-5 викладачів, до 20 оцінок у кожного студента з усіх предметів). Використовуйте пакет Faker для наповнення. При заповненні використовуємо механізм сесій SQLAlchemy.    

* Четвертий крок
  
Зробити такі вибірки з отриманої бази даних:  
1. Знайти 5 студентів із найбільшим середнім балом з усіх предметів.
2. Знайти студента із найвищим середнім балом з певного предмета.
3. Знайти середній бал у групах з певного предмета.
4. Знайти середній бал на потоці (по всій таблиці оцінок).
5. Знайти які курси читає певний викладач.
6. Знайти список студентів у певній групі.
7. Знайти оцінки студентів у окремій групі з певного предмета.
8. Знайти середній бал, який ставить певний викладач зі своїх предметів.
9. Знайти список курсів, які відвідує певний студент.  
10. Список курсів, які певному студенту читає певний викладач.  

Для запитів оформити окремий файл my_select.py, де будуть 10 функцій від select_1 до select_10. Виконання функцій повинно повертати результат аналогічний попередньої домашньої роботи. При запитах використовуємо механізм сесій SQLAlchemy.  


## Процес створення бази даних і виконання завдання

### Підготовка проекту

У цьому завданні ми створимо базу даних (БД) Sqlite з використанням ORM пакета sqlalchemy, а також використаємо пакет alembic для створення та контролю міграцій.  
  
### Створюємо віртуальне середовище зхавдяки poetry  

```poetry new project_poetry```  
```cd project_poetry```  
```poetry shell```  
```poetry add faker```  
```poetry add alembic sqlalchemy```  
```alembic init alembic```  

### Налаштування пакета alembic  

Починаємо налаштовувати наше оточення. Потрібно знайти у файлі alembic.ini рядок  

```sqlalchemy.url = driver://user:pass@localhost/dbname```

І замінити його на шлях до нашої БД. Ми будемо використовувати файл study.db в корені проекту.   

```
sqlalchemy.url = sqlite:///study.db
```

Наступним кроком буде зміна файлу env.py. Тому що ми хочемо використовувати автогенерацію SQL скриптів в міграціях alembic — нам необхідно повідомити про це оточення у файлі env.py, який розташований у папці alembic.   
```alembic/env.py```  
```
from logging.config import fileConfig  
  
from sqlalchemy import engine_from_config  
from sqlalchemy import pool  
  
from alembic import context  
  
from models import Base  
```
  
Далі нам необхідно знайти рядок: ```target_metadata = None``` і замість None, вказати наші метадані:  
```
target_metadata = Base.metadata
```

### Створення моделей

Тепер створимо моделі у файлі ```models.py``` для нашого завдання. У ньому ми опишемо ORM класи з використанням sqlalchemy.  

### Створення міграцій

```
alembic revision --autogenerate -m 'Init'
```
  
```
alembic upgrade head
```

Створимо в корені проекту файл підключення до БД ```connect_db.py```.  

Потім створюємо у корені проекту файл ```seeds.py``` щоб заповнити нашу базу даних. Виконаємо його:  
```
poetry run python seeds.py
```  
Далі створюємо файл з запитами ```my_select.py```.   
Потім створюємо і виконуємо файл main.py з виведенням результатів виконання запитів у файл ```results.txt```:
```
poetry run python main.py
```

## Результати

Результати містяться в ```results.txt```.  
